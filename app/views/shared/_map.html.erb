<% "AIzaSyD5OLpTd7Q483-N9EAcaQzkm7pXgRgBGm4" %>

<% center = {} %>

<% @list_of_sorted_cities.each do |city| %>
  <% if city[:name].match?(@city_name) %>
    <% center[:lat] = city[:latitude] %>
    <% center[:lng] = city[:longitude] %>
  <% end %>
<% end %>

<div id="map">
</div>
<script>
  function initMap() {
    var center = {lat: <%= center[:lat].to_s %>, lng: <%= center[:lng].to_s %>};

    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 10,
      center: center
    });

    var markers = {};

    <% @list_of_sorted_cities.each do |city| %>;
        markers["<%= city[:name] %>"] = new google.maps.Marker({
          position: {lat: <%= city[:latitude].to_s %>, lng: <%= city[:longitude].to_s %>},
          map: map
        });
    <% end %>;

    <% @list_of_sorted_cities.each do |city| %>;
        google.maps.event.addListener(markers["<%= city[:name] %>"], 'click', function() {
      <% @results[city[:name]]["posts"].each do |article| %>
          alert("<%= article["title"] %>");
      <% end %>;
        });
    <% end %>;

    // google.maps.event.addListener(map, 'bounds_changed', function() {
    //       console.log("West: " + map.getBounds().b.b);
    //       console.log("East: " + map.getBounds().b.f);
    //       console.log("North: " + map.getBounds().f.f);
    //       console.log("South: " + map.getBounds().f.b);
    //     });
  }
</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5OLpTd7Q483-N9EAcaQzkm7pXgRgBGm4&callback=initMap">
</script>
